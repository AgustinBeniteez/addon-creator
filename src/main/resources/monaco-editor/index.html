<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background-color: #1e1e1e; }
        #container { width: 100%; height: 100%; }
    </style>
</head>
<body>
<div id="container"></div>
<script src="vs/loader.js"></script>
<script>
    require.config({ paths: { 'vs': 'vs' } });
    
    var editor;
    
    require(['vs/editor/editor.main'], function() {
        // Configure JSON validation to be more permissive for Bedrock addons
        // Disabling validation to prevent false positives with Minecraft JSON files
        monaco.languages.json.jsonDefaults.setDiagnosticsOptions({
            validate: true,
            allowComments: true,
            schemas: [],
            enableSchemaRequest: false,
            trailingCommas: 'ignore'
        });

        editor = monaco.editor.create(document.getElementById('container'), {
            value: "",
            language: 'json',
            theme: 'vs-dark',
            automaticLayout: true,
            minimap: { enabled: true },
            scrollBeyondLastLine: false,
            fontSize: 14,
            fontFamily: 'Consolas, "Courier New", monospace',
            formatOnPaste: true,
            formatOnType: true
        });
        
        // Add change listener to notify Java if needed
        editor.onDidChangeModelContent(function(e) {
            if (window.javaApp && typeof window.javaApp.onContentChange === 'function') {
                window.javaApp.onContentChange();
            }
        });
    });
    
    function initEditor(content, lang) {
        if (editor) {
            editor.setValue(content);
            monaco.editor.setModelLanguage(editor.getModel(), lang);
            setTimeout(function() {
                editor.getAction('editor.action.formatDocument').run();
            }, 100);
        } else {
            // Wait for editor to initialize
            setTimeout(function() { initEditor(content, lang); }, 100);
        }
    }

    function setContent(content) {
        if (editor) {
            // Disable listener temporarily to avoid triggering change event on load
            // Actually, we can just ignore the first change or handle it in Java
            // But let's just set value.
            editor.setValue(content);
            // Auto-format when setting content initially
            setTimeout(function() {
                editor.getAction('editor.action.formatDocument').run();
            }, 100);
        }
    }
    
    function getContent() {
        if (editor) {
            return editor.getValue();
        }
        return "";
    }
    
    function setLanguage(lang) {
        if (editor) {
            monaco.editor.setModelLanguage(editor.getModel(), lang);
        }
    }
    
    function setTheme(theme) {
        if (editor) {
            monaco.editor.setTheme(theme);
        }
    }
    
    function formatCode() {
        if (editor) {
            editor.getAction('editor.action.formatDocument').run();
        }
    }
</script>
</body>
</html>